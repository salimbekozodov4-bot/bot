<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Donate Bridge</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent1:#7c3aed;--accent2:#06b6d4;--muted:#9aa6bf;--glass:rgba(255,255,255,0.03);--success:#10b981;--danger:#ef4444}
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow-x:hidden}
    body{font-family:Inter,system-ui,sans-serif;background:linear-gradient(180deg,#071029 0%,#0a1525 50%,#071a2b 100%);color:#e6eef8;padding-bottom:90px}
    
    .container{max-width:1100px;margin:0 auto;padding:16px}
    
    /* Status bar */
    .status-bar{background:linear-gradient(90deg,var(--success),#059669);color:white;padding:14px;text-align:center;font-size:14px;font-weight:700;box-shadow:0 4px 20px rgba(16,185,129,0.4);display:none;position:sticky;top:0;z-index:90;letter-spacing:0.3px}
    .status-bar.show{display:block;animation:slideDown 0.4s ease}
    .status-bar.error{background:linear-gradient(90deg,var(--danger),#dc2626)}
    .status-bar i{margin-right:8px;font-size:16px}
    @keyframes slideDown{from{transform:translateY(-100%);opacity:0}to{transform:translateY(0);opacity:1}}

    /* Pages */
    .page{display:none;animation:fadeIn 0.3s}
    .page.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* Home page */
    .page-title{font-size:28px;font-weight:800;margin-bottom:20px;background:linear-gradient(90deg,white,var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:18px;margin-bottom:20px}
    
    .pass-card{background:linear-gradient(145deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));border-radius:20px;padding:20px;border:1px solid rgba(255,255,255,0.08);box-shadow:0 10px 40px rgba(2,6,23,0.5);transition:all 0.3s;position:relative;overflow:hidden}
    .pass-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent1),var(--accent2));opacity:0;transition:opacity 0.3s}
    .pass-card:hover{transform:translateY(-4px);box-shadow:0 16px 50px rgba(124,58,237,0.3);border-color:rgba(124,58,237,0.4)}
    .pass-card:hover::before{opacity:1}
    
    .pass-header{display:flex;gap:16px;margin-bottom:16px}
    .pass-icon{width:90px;height:90px;border-radius:16px;flex-shrink:0;overflow:hidden;background:var(--glass);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 24px rgba(0,0,0,0.3)}
    .pass-icon img{width:100%;height:100%;object-fit:cover}
    
    .pass-info{flex:1}
    .pass-name{font-size:20px;font-weight:700;margin-bottom:8px;color:white;letter-spacing:0.3px}
    .pass-desc{font-size:14px;color:var(--muted);line-height:1.5;margin-bottom:10px}
    .pass-price{font-size:26px;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    
    .btn-donate{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;padding:14px 24px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:15px;width:100%;box-shadow:0 6px 20px rgba(124,58,237,0.4);transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px}
    .btn-donate:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(124,58,237,0.5)}
    .btn-donate:active{transform:translateY(0)}

    /* Profile page */
    .profile-container{max-width:600px;margin:0 auto}
    .profile-header{background:linear-gradient(145deg,rgba(124,58,237,0.15),rgba(6,182,212,0.08));border-radius:24px;padding:32px;text-align:center;border:1px solid rgba(255,255,255,0.06);box-shadow:0 12px 40px rgba(2,6,23,0.4);margin-bottom:24px;position:relative;overflow:hidden}
    .profile-header::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--accent1),var(--accent2))}
    
    .profile-avatar{width:120px;height:120px;border-radius:50%;margin:0 auto 20px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:800;color:white;box-shadow:0 16px 40px rgba(124,58,237,0.4);overflow:hidden;border:4px solid rgba(255,255,255,0.1)}
    .profile-avatar img{width:100%;height:100%;object-fit:cover}
    
    .profile-name{font-size:28px;font-weight:800;margin-bottom:6px;color:white;letter-spacing:0.5px}
    .profile-username{color:var(--accent2);font-size:16px;font-weight:600;margin-bottom:20px}
    .profile-id{color:var(--muted);font-size:13px;font-weight:500;opacity:0.7}
    
    .profile-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-top:24px}
    .stat-card{background:rgba(255,255,255,0.03);border-radius:16px;padding:16px;border:1px solid rgba(255,255,255,0.05);text-align:center}
    .stat-value{font-size:32px;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px}
    .stat-label{font-size:13px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px}

    /* Donate history */
    .section-title{font-size:20px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:10px;color:white}
    .section-title i{color:var(--accent2)}
    
    .history-item{background:linear-gradient(145deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));border-radius:16px;padding:18px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;gap:14px;transition:all 0.2s}
    .history-item:hover{transform:translateX(4px);border-color:rgba(124,58,237,0.3);box-shadow:0 4px 16px rgba(124,58,237,0.2)}
    
    .history-icon{width:50px;height:50px;border-radius:12px;background:linear-gradient(135deg,rgba(124,58,237,0.2),rgba(6,182,212,0.2));display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--accent2);flex-shrink:0}
    .history-meta{flex:1;min-width:0}
    .history-title{font-weight:700;margin-bottom:4px;font-size:15px;color:white}
    .history-date{color:var(--muted);font-size:12px;font-weight:500}
    .history-amount{font-weight:800;color:var(--accent2);font-size:18px;white-space:nowrap}

    /* Empty states */
    .empty{text-align:center;padding:60px 20px;color:var(--muted)}
    .empty i{font-size:72px;opacity:0.15;margin-bottom:20px;display:block}
    .empty-title{font-size:18px;font-weight:700;margin-bottom:8px;color:white}
    .empty-text{font-size:14px;line-height:1.6}

    /* Bottom navigation */
    .bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:linear-gradient(145deg,rgba(15,23,42,0.95),rgba(11,18,32,0.95));backdrop-filter:blur(20px);width:calc(100% - 32px);max-width:700px;border-radius:20px;padding:12px;display:flex;justify-content:space-around;align-items:center;box-shadow:0 20px 60px rgba(2,6,23,0.8);border:1px solid rgba(255,255,255,0.1);z-index:80}
    .nav-item{flex:1;text-align:center;padding:12px 8px;border-radius:14px;color:var(--muted);font-size:11px;cursor:pointer;transition:all 0.3s;font-weight:600;letter-spacing:0.3px}
    .nav-item:hover{color:white;background:rgba(255,255,255,0.03)}
    .nav-item.active{background:linear-gradient(135deg,rgba(124,58,237,0.25),rgba(6,182,212,0.15));color:white;box-shadow:0 4px 16px rgba(124,58,237,0.4)}
    .nav-item i{display:block;font-size:22px;margin-bottom:6px;transition:all 0.3s}
    .nav-item.active i{transform:scale(1.1)}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(1,3,10,0.85);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;padding:20px;z-index:100;opacity:0;pointer-events:none;transition:opacity 0.3s}
    .modal.show{opacity:1;pointer-events:auto}
    .modal-content{background:linear-gradient(145deg,#0e1a30,#0a1220);border-radius:24px;padding:28px;max-width:440px;width:100%;border:1px solid rgba(255,255,255,0.1);box-shadow:0 30px 80px rgba(0,0,0,0.6);animation:modalSlideUp 0.3s ease}
    @keyframes modalSlideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
    
    .modal-title{font-size:24px;font-weight:800;margin-bottom:12px;color:white;letter-spacing:0.3px}
    .modal-text{color:var(--muted);font-size:15px;margin-bottom:24px;line-height:1.6}
    .modal-actions{display:flex;gap:12px}
    .btn{padding:14px 28px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:15px;flex:1;transition:all 0.2s}
    .btn-cancel{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--muted)}
    .btn-cancel:hover{border-color:rgba(255,255,255,0.2);color:white;background:rgba(255,255,255,0.08)}
    .btn-confirm{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 6px 20px rgba(124,58,237,0.4)}
    .btn-confirm:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(124,58,237,0.5)}

    @media(max-width:600px){
      .grid{grid-template-columns:1fr}
      .pass-header{flex-direction:column;align-items:center;text-align:center}
      .profile-stats{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <!-- Status bar -->
  <div class="status-bar" id="statusBar">
    <i class="fa-solid fa-circle-check"></i>
    <span id="statusText">Telegram botga ulandi</span>
  </div>

  <div class="container">
    <!-- Home page -->
    <div class="page active" id="homePage">
      <h1 class="page-title">üéÅ Mavjud passlar</h1>
      <div class="grid" id="passesGrid"></div>
      <div class="empty" id="emptyPasses" style="display:none">
        <i class="fa-solid fa-box-open"></i>
        <div class="empty-title">Hozircha passlar yo'q</div>
        <div class="empty-text">Passlar tez orada qo'shiladi</div>
      </div>
    </div>

    <!-- Profile page -->
    <div class="page" id="profilePage">
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-avatar" id="profileAvatar">
            <i class="fa-solid fa-user"></i>
          </div>
          <h2 class="profile-name" id="profileName">Foydalanuvchi</h2>
          <div class="profile-username" id="profileUsername">@username</div>
          <div class="profile-id" id="profileId">ID: 0</div>
          
          <div class="profile-stats">
            <div class="stat-card">
              <div class="stat-value" id="totalDonates">0</div>
              <div class="stat-label">Donatlar</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalPoints">0</div>
              <div class="stat-label">Jami ball</div>
            </div>
          </div>
        </div>

        <h3 class="section-title">
          <i class="fa-solid fa-clock-rotate-left"></i>
          Donat tarixi
        </h3>
        <div id="donateHistory"></div>
        <div class="empty" id="emptyHistory" style="display:none">
          <i class="fa-solid fa-inbox"></i>
          <div class="empty-title">Hali donat qilmagansiz</div>
          <div class="empty-text">Birinchi donat qiling va bu yerda ko'ring</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom navigation -->
  <nav class="bottom-nav">
    <div class="nav-item active" data-page="home">
      <i class="fa-solid fa-house"></i>
      Bosh sahifa
    </div>
    <div class="nav-item" data-page="profile">
      <i class="fa-solid fa-user"></i>
      Profil
    </div>
  </nav>

  <!-- Donate modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3 class="modal-title">Donat tasdiqlash</h3>
      <p class="modal-text" id="modalText">Donat qilmoqchimisiz?</p>
      <div class="modal-actions">
        <button class="btn btn-cancel" id="btnCancel">Bekor qilish</button>
        <button class="btn btn-confirm" id="btnConfirm">
          <i class="fa-solid fa-heart"></i> Tasdiqlash
        </button>
      </div>
    </div>
  </div>

  <script>
    const BOT_ID = '8567908525'; // Sizning bot ID
    
    const statusBar = document.getElementById('statusBar');
    const statusText = document.getElementById('statusText');
    const passesGrid = document.getElementById('passesGrid');
    const emptyPasses = document.getElementById('emptyPasses');
    const modal = document.getElementById('modal');
    const modalText = document.getElementById('modalText');
    const btnCancel = document.getElementById('btnCancel');
    const btnConfirm = document.getElementById('btnConfirm');
    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page');
    const donateHistory = document.getElementById('donateHistory');
    const emptyHistory = document.getElementById('emptyHistory');

    let selectedPass = null;
    let userData = {
      id: 0,
      firstName: 'Foydalanuvchi',
      lastName: '',
      username: 'username',
      photoUrl: null,
      donateHistory: []
    };

    const isTelegram = !!(window.Telegram && window.Telegram.WebApp);
    const tg = isTelegram ? window.Telegram.WebApp : null;

    // Initialize
    async function init(){
      if(tg){
        try{
          tg.ready();
          tg.expand();
          
          const user = tg.initDataUnsafe?.user;
          
          if(user && user.id){
            // Check bot ID
            const currentBotId = tg.initDataUnsafe?.bot_id?.toString() || '';
            
            if(currentBotId === BOT_ID){
              // Correct bot
              statusBar.classList.add('show');
              setTimeout(() => statusBar.classList.remove('show'), 3000);
              
              // Load user data
              userData = {
                id: user.id,
                firstName: user.first_name || 'User',
                lastName: user.last_name || '',
                username: user.username || '',
                photoUrl: user.photo_url || null,
                donateHistory: await loadDonateHistory(user.id)
              };
              
              updateProfile();
              
              // Load passes
              const passes = await loadPasses();
              renderPasses(passes);
            } else {
              // Wrong bot
              statusBar.classList.add('show', 'error');
              statusText.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Faqat maxsus botdan ochish mumkin!';
              passesGrid.innerHTML = '';
              emptyPasses.style.display = 'block';
              emptyPasses.innerHTML = `
                <i class="fa-solid fa-lock"></i>
                <div class="empty-title">Kirish taqiqlangan</div>
                <div class="empty-text">Bu app faqat maxsus bot orqali ishlaydi</div>
              `;
            }
          } else {
            showError('Foydalanuvchi ma\'lumotlari topilmadi');
          }
        }catch(e){
          console.error('Telegram init error:', e);
          showError('Telegram bilan bog\'lanishda xatolik');
        }
      } else {
        // Demo mode
        statusBar.classList.add('show', 'error');
        statusText.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Demo rejim - Telegram tashqarida';
        renderPasses(getDemoPasses());
        updateProfile();
      }
    }

    function showError(msg){
      statusBar.classList.add('show', 'error');
      statusText.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> ${msg}`;
    }

    // Load passes (from bot or demo)
    async function loadPasses(){
      // Bu yerda siz botdan passlarni olishingiz mumkin
      // Hozircha demo
      return getDemoPasses();
    }

    function getDemoPasses(){
      return [
        {
          id: 1,
          name: 'Premium Pass',
          desc: 'Premium a\'zolik - barcha imkoniyatlar ochiq',
          price: 100,
          icon: 'https://via.placeholder.com/90/7c3aed/ffffff?text=P'
        },
        {
          id: 2,
          name: 'Gold Pass',
          desc: 'Oltin a\'zolik - maxsus huquqlar va mukofotlar',
          price: 200,
          icon: 'https://via.placeholder.com/90/f59e0b/ffffff?text=G'
        },
        {
          id: 3,
          name: 'VIP Pass',
          desc: 'VIP a\'zolik - cheksiz imkoniyatlar va maxsus statuslar',
          price: 500,
          icon: 'https://via.placeholder.com/90/ef4444/ffffff?text=V'
        }
      ];
    }

    // Load donate history
    async function loadDonateHistory(userId){
      // Bu yerda Telegram Cloud Storage yoki bot API dan yuklanadi
      // Hozircha bo'sh
      return [];
    }

    // Render passes
    function renderPasses(passes){
      if(!passes || passes.length === 0){
        passesGrid.style.display = 'none';
        emptyPasses.style.display = 'block';
        return;
      }

      passesGrid.style.display = 'grid';
      emptyPasses.style.display = 'none';
      passesGrid.innerHTML = '';

      passes.forEach(pass => {
        const card = document.createElement('div');
        card.className = 'pass-card';
        card.innerHTML = `
          <div class="pass-header">
            <div class="pass-icon">
              <img src="${pass.icon}" alt="${pass.name}">
            </div>
            <div class="pass-info">
              <div class="pass-name">${pass.name}</div>
              <div class="pass-desc">${pass.desc}</div>
              <div class="pass-price">${pass.price} ball</div>
            </div>
          </div>
          <button class="btn-donate" data-id="${pass.id}">
            <i class="fa-solid fa-heart"></i>
            Donat qilish
          </button>
        `;
        
        card.querySelector('.btn-donate').addEventListener('click', () => {
          openModal(pass);
        });
        
        passesGrid.appendChild(card);
      });
    }

    // Update profile
    function updateProfile(){
      const avatar = document.getElementById('profileAvatar');
      const name = document.getElementById('profileName');
      const username = document.getElementById('profileUsername');
      const userId = document.getElementById('profileId');
      
      const fullName = `${userData.firstName} ${userData.lastName}`.trim();
      name.textContent = fullName || 'Foydalanuvchi';
      username.textContent = userData.username ? `@${userData.username}` : '@username';
      userId.textContent = `ID: ${userData.id}`;
      
      if(userData.photoUrl){
        avatar.innerHTML = `<img src="${userData.photoUrl}" alt="Avatar">`;
      } else {
        const initial = userData.firstName[0]?.toUpperCase() || 'U';
        avatar.textContent = initial;
      }

      // Update stats
      const totalDonates = userData.donateHistory.length;
      const totalPoints = userData.donateHistory.reduce((sum, d) => sum + d.amount, 0);
      document.getElementById('totalDonates').textContent = totalDonates;
      document.getElementById('totalPoints').textContent = totalPoints;

      // Render history
      renderHistory();
    }

    // Render donate history
    function renderHistory(){
      if(userData.donateHistory.length === 0){
        donateHistory.style.display = 'none';
        emptyHistory.style.display = 'block';
        return;
      }

      donateHistory.style.display = 'block';
      emptyHistory.style.display = 'none';
      donateHistory.innerHTML = userData.donateHistory.map(h => `
        <div class="history-item">
          <div class="history-icon">
            <i class="fa-solid fa-gift"></i>
          </div>
          <div class="history-meta">
            <div class="history-title">${h.passName}</div>
            <div class="history-date">${h.date}</div>
          </div>
          <div class="history-amount">${h.amount} ball</div>
        </div>
      `).join('');
    }

    // Modal functions
    function openModal(pass){
      selectedPass = pass;
      modalText.textContent = `${pass.name} uchun ${pass.price} ball donat qilmoqchimisiz?`;
      modal.classList.add('show');
    }

    function closeModal(){
      modal.classList.remove('show');
      selectedPass = null;
    }

    function confirmDonate(){
      if(!selectedPass) return;

      const donateData = {
        type: 'donate',
        userId: userData.id,
        passId: selectedPass.id,
        passName: selectedPass.name,
        price: selectedPass.price,
        timestamp: Date.now()
      };

      // Add to history
      const now = new Date();
      const dateStr = now.toLocaleDateString('uz-UZ', {
        day: '2-digit',
        month: 'short',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      userData.donateHistory.unshift({
        passName: selectedPass.name,
        amount: selectedPass.price,
        date: dateStr
      });

      updateProfile();

      if(tg){
        try{
          tg.sendData(JSON.stringify(donateData));
          tg.close();
        }catch(e){
          console.error('Send error:', e);
          alert('Xatolik yuz berdi');
        }
      } else {
        alert(`‚úÖ Donat qilindi!\n\nPass: ${selectedPass.name}\nMiqdor: ${selectedPass.price} ball`);
        closeModal();
      }
    }

    // Navigation
    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const pageName = item.dataset.page;
        
        navItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        pages.forEach(p => p.classList.remove('active'));
        document.getElementById(pageName + 'Page').classList.add('active');
      });
    });

    // Event listeners
    btnCancel.addEventListener('click', closeModal);
    btnConfirm.addEventListener('click', confirmDonate);
    modal.addEventListener('click', (e) => {
      if(e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') closeModal();
    });

    // Initialize app
    init();
  </script>
</body>
</html>
